<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tech Test Generator | Myrealtrip</title>
  <style>
    /*
      Chosen Palette: Warm Neutrals & Subtle Accent
      - Background: #F7F9FC (Almost white, very light blue/gray)
      - Text: #1F2937 (Dark Slate)
      - Primary Accent: #059669 (Emerald Green for trust and growth)
      - Secondary/Cards: #FFFFFF (White) with soft shadows
    */
    
    :root {
      --bg-color: #F7F9FC;
      --text-color: #1F2937;
      --accent-color: #059669;
      --card-color: #FFFFFF;
      --light-accent: #E6F4F1;
      --gray-color: #6B7280;
      --slate-100: #f1f5f9;
      --slate-700: #334155;
      --emerald-50: #ecfdf5;
      --emerald-500: #10b981;
      --emerald-600: #059669;
      --emerald-700: #047857;
      --shadow-sm: 0 1px 2px rgba(0,0,0,.05);
      --shadow: 0 1px 3px rgba(0,0,0,.1), 0 1px 2px rgba(0,0,0,.06);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,.1), 0 4px 6px -2px rgba(0,0,0,.05);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      min-height: 100vh;
    }
    
    /* Header */
    .header {
      background: var(--card-color);
      box-shadow: var(--shadow);
      padding: 1rem 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .header__container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .header__logo img {
      height: 32px;
      display: block;
    }
    
    .header__title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-color);
    }
    
    /* Main Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 3rem 1.5rem;
    }
    
    /* Hero Section */
    .hero {
      text-align: center;
      margin-bottom: 3rem;
    }
    
    .hero__title {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--text-color);
      margin-bottom: 0.75rem;
    }
    
    .hero__subtitle {
      font-size: 1.25rem;
      color: var(--gray-color);
      margin-bottom: 1rem;
    }
    
    .hero__badge {
      display: inline-block;
      background: var(--emerald-50);
      color: var(--accent-color);
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 600;
    }
    
    /* Form Card */
    .form-card {
      background: var(--card-color);
      border-radius: 16px;
      box-shadow: var(--shadow-lg);
      padding: 2.5rem;
      max-width: 600px;
      margin: 0 auto 2rem;
    }
    
    .form-card__title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-color);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      font-weight: 600;
      color: var(--text-color);
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }
    
    .form-group select,
    .form-group input {
      width: 100%;
      padding: 0.875rem 1rem;
      border: 2px solid var(--slate-100);
      border-radius: 8px;
      font-size: 1rem;
      color: var(--text-color);
      background: var(--card-color);
      transition: all 0.2s ease;
    }
    
    .form-group select:focus,
    .form-group input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px var(--light-accent);
    }
    
    .btn {
      width: 100%;
      padding: 1rem 2rem;
      background: var(--accent-color);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.125rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: var(--shadow);
    }
    
    .btn:hover:not(:disabled) {
      background: var(--emerald-700);
      box-shadow: var(--shadow-lg);
      transform: translateY(-1px);
    }
    
    .btn:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .btn--loading {
      position: relative;
      color: transparent;
    }
    
    .btn--loading::after {
      content: "";
      position: absolute;
      width: 20px;
      height: 20px;
      top: 50%;
      left: 50%;
      margin-left: -10px;
      margin-top: -10px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Status Card */
    .status-card {
      background: var(--card-color);
      border-radius: 16px;
      box-shadow: var(--shadow-lg);
      padding: 2rem;
      max-width: 1000px;
      margin: 0 auto 2rem;
      display: none;
    }
    
    .status-card.visible {
      display: block;
    }
    
    /* Agent Team Display */
    .agents-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }
    
    .agent-card {
      background: var(--slate-100);
      border: 2px solid transparent;
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .agent-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gray-color);
      transition: all 0.3s ease;
    }
    
    .agent-card.pending {
      opacity: 0.6;
    }
    
    .agent-card.pending::before {
      background: var(--gray-color);
    }
    
    .agent-card.active {
      border-color: var(--accent-color);
      background: var(--emerald-50);
      box-shadow: 0 0 0 3px var(--light-accent);
      animation: pulse-border 2s ease-in-out infinite;
    }
    
    .agent-card.active::before {
      background: var(--accent-color);
      animation: shimmer 2s ease-in-out infinite;
    }
    
    .agent-card.reviewing {
      border-color: #f59e0b;
      background: #fef3c7;
    }
    
    .agent-card.reviewing::before {
      background: #f59e0b;
    }
    
    .agent-card.completed {
      border-color: var(--accent-color);
      background: var(--card-color);
    }
    
    .agent-card.completed::before {
      background: var(--accent-color);
    }
    
    @keyframes pulse-border {
      0%, 100% { box-shadow: 0 0 0 3px var(--light-accent); }
      50% { box-shadow: 0 0 0 6px var(--light-accent); }
    }
    
    .agent-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      display: block;
    }
    
    .agent-name {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-color);
      margin-bottom: 0.25rem;
    }
    
    .agent-role {
      font-size: 0.75rem;
      color: var(--gray-color);
    }
    
    .agent-badge {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: var(--accent-color);
      color: white;
      font-size: 0.65rem;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-weight: 600;
      display: none;
    }
    
    .agent-card.active .agent-badge {
      display: block;
      animation: bounce 1s ease-in-out infinite;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
    }
    
    .discussion-phase {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border: 2px solid #f59e0b;
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
      display: none;
    }
    
    .discussion-phase.visible {
      display: block;
      animation: slideIn 0.5s ease-out;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .discussion-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #92400e;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .discussion-content {
      color: #78350f;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    .team-section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-color);
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .status-card__header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .status-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    
    .status-icon--running {
      background: var(--emerald-50);
      animation: pulse 2s ease-in-out infinite;
    }
    
    .status-icon--completed {
      background: var(--emerald-50);
    }
    
    .status-icon--failed {
      background: #fee2e2;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .status-card__title {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-color);
    }
    
    .status-card__subtitle {
      color: var(--gray-color);
      font-size: 0.95rem;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--slate-100);
      border-radius: 9999px;
      overflow: hidden;
      margin-bottom: 1rem;
    }
    
    .progress-bar__fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-color), var(--emerald-500));
      border-radius: 9999px;
      transition: width 0.5s ease;
      animation: shimmer 2s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    
    .status-message {
      color: var(--gray-color);
      font-size: 0.95rem;
      margin-bottom: 1.5rem;
    }
    
    /* Agent Activity Boxes - Fixed Grid */
    .activities-section {
      margin-top: 1.5rem;
    }
    
    .activities-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-color);
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .activities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .activity-box {
      background: var(--card-color);
      border: 3px solid var(--slate-100);
      border-radius: 12px;
      padding: 1.25rem;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      height: 220px;
      display: flex;
      flex-direction: column;
    }
    
    .activity-box:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }
    
    .activity-box.active {
      border-color: var(--accent-color);
      border-width: 3px;
      box-shadow: 0 0 0 4px var(--light-accent), var(--shadow-lg);
      animation: pulse-box 2s ease-in-out infinite;
    }
    
    .activity-box.completed {
      border-color: #10b981;
      opacity: 0.9;
    }
    
    @keyframes pulse-box {
      0%, 100% { box-shadow: 0 0 0 4px var(--light-accent), var(--shadow-lg); }
      50% { box-shadow: 0 0 0 8px var(--light-accent), var(--shadow-lg); }
    }
    
    .activity-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--slate-100);
    }
    
    .activity-icon {
      font-size: 2rem;
      line-height: 1;
    }
    
    .activity-agent-info {
      flex: 1;
      min-width: 0;
    }
    
    .activity-agent-name {
      font-weight: 700;
      color: var(--text-color);
      font-size: 0.95rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .activity-status-badge {
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      border-radius: 9999px;
      font-weight: 600;
      background: var(--slate-100);
      color: var(--gray-color);
    }
    
    .activity-box.active .activity-status-badge {
      background: var(--accent-color);
      color: white;
      animation: pulse-badge 1.5s ease-in-out infinite;
    }
    
    @keyframes pulse-badge {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .activity-summary {
      flex: 1;
      color: var(--text-color);
      font-size: 0.875rem;
      line-height: 1.5;
      overflow-y: auto;
      margin-bottom: 0.75rem;
      padding-right: 0.5rem;
    }
    
    .activity-summary::-webkit-scrollbar {
      width: 4px;
    }
    
    .activity-summary::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 2px;
    }
    
    .activity-empty {
      color: var(--gray-color);
      font-style: italic;
      font-size: 0.85rem;
    }
    
    /* Agent Message Formatting */
    .agent-message {
      margin: 0.5rem 0;
      padding: 0.5rem;
      border-left: 3px solid;
      background: rgba(0,0,0,0.02);
      border-radius: 4px;
    }
    
    .agent-message.pm {
      border-left-color: #8b5cf6;
      background: rgba(139, 92, 246, 0.05);
    }
    
    .agent-message.researcher {
      border-left-color: #0ea5e9;
      background: rgba(14, 165, 233, 0.05);
    }
    
    .agent-message.designer {
      border-left-color: #f59e0b;
      background: rgba(245, 158, 11, 0.05);
    }
    
    .agent-message.reviewer {
      border-left-color: #ef4444;
      background: rgba(239, 68, 68, 0.05);
    }
    
    .agent-message.writer {
      border-left-color: #10b981;
      background: rgba(16, 185, 129, 0.05);
    }
    
    .agent-speaker {
      font-weight: 700;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      margin-bottom: 0.25rem;
    }
    
    .agent-speaker-icon {
      font-size: 1rem;
    }
    
    .task-separator {
      border-top: 2px dashed var(--slate-100);
      margin: 0.75rem 0;
      padding-top: 0.75rem;
    }
    
    .task-label {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--accent-color);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }
    
    .activity-expand-hint {
      text-align: center;
      color: var(--accent-color);
      font-size: 0.75rem;
      font-weight: 600;
      margin-top: auto;
      padding-top: 0.5rem;
      border-top: 1px dashed var(--slate-100);
    }
    
    .activity-box:hover .activity-expand-hint {
      text-decoration: underline;
    }
    
    /* Expanded Activity Modal */
    .activity-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }
    
    .activity-modal.visible {
      display: flex;
    }
    
    .activity-modal-content {
      background: var(--card-color);
      border-radius: 16px;
      max-width: 700px;
      max-height: 80vh;
      width: 100%;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 25px -5px rgba(0,0,0,.3);
    }
    
    .activity-modal-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.5rem;
      border-bottom: 2px solid var(--slate-100);
    }
    
    .activity-modal-icon {
      font-size: 2.5rem;
    }
    
    .activity-modal-title {
      flex: 1;
    }
    
    .activity-modal-name {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-color);
    }
    
    .activity-modal-role {
      font-size: 0.9rem;
      color: var(--gray-color);
    }
    
    .activity-modal-close {
      background: var(--slate-100);
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    
    .activity-modal-close:hover {
      background: var(--slate-700);
      color: white;
    }
    
    .activity-modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem;
      line-height: 1.6;
      white-space: pre-wrap;
      font-size: 0.95rem;
    }
    
    .activity-modal-body::-webkit-scrollbar {
      width: 8px;
    }
    
    .activity-modal-body::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 4px;
    }
    
    /* Agent Logs */
    .logs-section {
      margin-top: 1.5rem;
      border-top: 1px solid var(--slate-100);
      padding-top: 1.5rem;
    }
    
    .logs-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      cursor: pointer;
      user-select: none;
    }
    
    .logs-header:hover {
      color: var(--accent-color);
    }
    
    .logs-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      color: var(--text-color);
    }
    
    .logs-toggle {
      font-size: 1.25rem;
      transition: transform 0.3s ease;
    }
    
    .logs-toggle.collapsed {
      transform: rotate(-90deg);
    }
    
    .logs-container {
      background: var(--slate-700);
      border-radius: 8px;
      padding: 1rem;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
      font-size: 0.85rem;
      line-height: 1.5;
      color: #e5e7eb;
      display: none;
    }
    
    .logs-container.visible {
      display: block;
    }
    
    .logs-container::-webkit-scrollbar {
      width: 8px;
    }
    
    .logs-container::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }
    
    .logs-container::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 4px;
    }
    
    .log-line {
      padding: 0.25rem 0;
      white-space: pre-wrap;
      word-break: break-word;
    }
    
    .log-line.agent-thought {
      color: #60a5fa;
    }
    
    .log-line.agent-action {
      color: #34d399;
      font-weight: 600;
    }
    
    .log-line.agent-observation {
      color: #fbbf24;
    }
    
    .log-line.agent-final {
      color: #a78bfa;
      font-weight: 600;
    }
    
    .log-line.error {
      color: #f87171;
      font-weight: 600;
    }
    
    .log-line.success {
      color: #4ade80;
    }
    
    .logs-empty {
      color: var(--gray-color);
      font-style: italic;
      text-align: center;
      padding: 2rem;
    }
    
    .btn-secondary {
      background: var(--slate-100);
      color: var(--text-color);
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
    }
    
    .btn-secondary:hover {
      background: var(--slate-700);
      color: white;
    }
    
    .result-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: var(--accent-color);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.2s ease;
    }
    
    .result-link:hover {
      background: var(--emerald-700);
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }
    
    /* Jobs List */
    .jobs-section {
      max-width: 900px;
      margin: 3rem auto 0;
    }
    
    .jobs-section__title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-color);
      margin-bottom: 1.5rem;
      text-align: center;
    }
    
    .job-card {
      background: var(--card-color);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 1.5rem;
      margin-bottom: 1rem;
      transition: all 0.2s ease;
    }
    
    .job-card:hover {
      box-shadow: var(--shadow-lg);
    }
    
    .job-card__header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 0.75rem;
    }
    
    .job-card__title {
      font-weight: 600;
      color: var(--text-color);
    }
    
    .job-card__badge {
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .job-card__badge--completed {
      background: var(--emerald-50);
      color: var(--accent-color);
    }
    
    .job-card__badge--running {
      background: #dbeafe;
      color: #1e40af;
    }
    
    .job-card__badge--failed {
      background: #fee2e2;
      color: #dc2626;
    }
    
    .job-card__info {
      color: var(--gray-color);
      font-size: 0.875rem;
    }
    
    /* Footer */
    .footer {
      text-align: center;
      padding: 2rem 1rem;
      color: var(--gray-color);
      border-top: 1px solid var(--slate-100);
      margin-top: 4rem;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header__container">
      <a href='https://www.myrealtrip.com/' target='_blank' rel='noopener' class='header__logo' aria-label='Myrealtrip ÌôàÏúºÎ°ú Ïù¥Îèô'>
        <img src='https://cdn.prod.website-files.com/652cf379a649f747375f2efe/65b9f0d4c60108a9d95c20c2_%EB%B3%80%EA%B2%BD%ED%95%84%EC%9A%94)%EB%A7%88%EC%9D%B4%EB%A6%AC%EC%96%BC%ED%8A%B8%EB%A6%BD.jpg' alt='Myrealtrip Î°úÍ≥†'>
      </a>
      <h1 class="header__title">Tech Test Generator</h1>
    </div>
  </header>

  <!-- Main Container -->
  <div class="container">
    <!-- Hero Section -->
    <div class="hero">
      <h1 class="hero__title">AI-Powered Tech Test Generator</h1>
      <p class="hero__subtitle">Create comprehensive coding assignments in minutes</p>
      <span class="hero__badge">ü§ñ Powered by NVIDIA minimax-m2 & CrewAI</span>
    </div>

    <!-- Form Card -->
    <div class="form-card">
      <h2 class="form-card__title">Generate Tech Test</h2>
      <form id="generateForm">
        <div class="form-group">
          <label for="jobRole">Job Role *</label>
          <select id="jobRole" name="job_role" required>
            <option value="">Select a role...</option>
            <option value="iOS Developer">iOS Developer</option>
            <option value="Android Developer">Android Developer</option>
            <option value="Frontend Developer">Frontend Developer</option>
            <option value="Backend Developer">Backend Developer</option>
            <option value="Full Stack Developer">Full Stack Developer</option>
            <option value="Data Engineer">Data Engineer</option>
            <option value="ML Engineer">ML Engineer</option>
            <option value="DevOps Engineer">DevOps Engineer</option>
            <option value="QA Engineer">QA Engineer</option>
          </select>
        </div>

        <div class="form-group">
          <label for="jobLevel">Job Level *</label>
          <select id="jobLevel" name="job_level" required>
            <option value="">Select a level...</option>
            <option value="Junior">Junior</option>
            <option value="Mid-level">Mid-level</option>
            <option value="Senior">Senior</option>
            <option value="Principal">Principal</option>
            <option value="Staff">Staff</option>
          </select>
        </div>

        <div class="form-group">
          <label for="language">Language *</label>
          <select id="language" name="language" required>
            <option value="Korean">Korean (ÌïúÍµ≠Ïñ¥)</option>
            <option value="English">English</option>
            <option value="Japanese">Japanese (Êó•Êú¨Ë™û)</option>
            <option value="Chinese">Chinese (‰∏≠Êñá)</option>
          </select>
        </div>

        <button type="submit" class="btn" id="generateBtn">
          <span id="btnText">üöÄ Generate Tech Test</span>
        </button>
      </form>
    </div>

    <!-- Status Card -->
    <div class="status-card" id="statusCard">
      <div class="status-card__header">
        <div class="status-icon" id="statusIcon">‚ö°</div>
        <div>
          <h3 class="status-card__title" id="statusTitle">Generating...</h3>
          <p class="status-card__subtitle" id="statusSubtitle">Please wait</p>
        </div>
      </div>
      
      <div class="progress-bar">
        <div class="progress-bar__fill" id="progressBar" style="width: 0%"></div>
      </div>
      
      <p class="status-message" id="statusMessage">Initializing agents...</p>
      
      <div style="text-align: center; margin-bottom: 1rem;">
        <small style="color: var(--gray-color); font-family: monospace;">
          Job ID: <span id="jobIdDisplay">-</span>
        </small>
      </div>
      
      <!-- CrewAI Team Display -->
      <div class="team-section-title">ü§ñ CrewAI Team Status</div>
      <div class="agents-grid" id="agentsGrid">
        <!-- Agents will be populated here -->
      </div>
      
      <!-- Agent Activity Boxes (Fixed Grid) -->
      <div class="activities-section">
        <div class="activities-title">üí¨ Agent Activity & Thinking</div>
        <div class="activities-grid" id="activitiesGrid">
          <!-- Activity boxes will be populated here -->
        </div>
      </div>
      
      <!-- Activity Modal (for expanded view) -->
      <div class="activity-modal" id="activityModal">
        <div class="activity-modal-content">
          <div class="activity-modal-header">
            <span class="activity-modal-icon" id="modalIcon">ü§ñ</span>
            <div class="activity-modal-title">
              <div class="activity-modal-name" id="modalName">Agent Name</div>
              <div class="activity-modal-role" id="modalRole">Role</div>
            </div>
            <button class="activity-modal-close" onclick="closeActivityModal()">√ó</button>
          </div>
          <div class="activity-modal-body" id="modalBody">
            Full conversation details will appear here...
          </div>
        </div>
      </div>
      
      <!-- Discussion Phase -->
      <div class="discussion-phase" id="discussionPhase">
        <div class="discussion-title">
          <span>üí¨</span>
          <span>Team Discussion in Progress</span>
        </div>
        <div class="discussion-content" id="discussionContent">
          Agents are collaborating and reviewing outputs...
        </div>
      </div>
      
      <!-- Agent Logs Section (Collapsed by Default) -->
      <div class="logs-section">
        <div class="logs-header" onclick="toggleLogs()">
          <div class="logs-title">
            <span>ü§ñ</span>
            <span>Agent Discussion & Analysis</span>
            <span class="logs-toggle" id="logsToggle">‚ñº</span>
          </div>
        </div>
        <div class="logs-container visible" id="logsContainer">
          <div class="logs-empty" id="logsEmpty">Waiting for agents to start...</div>
        </div>
      </div>
      
      <div id="statusActions" style="text-align: center; display: none;">
        <a href="#" id="resultLink" class="result-link" target="_blank">
          üìÑ View Generated Tech Test
        </a>
      </div>
    </div>

    <!-- Recent Jobs -->
    <div class="jobs-section" id="jobsSection" style="display: none;">
      <h2 class="jobs-section__title">Recent Generations</h2>
      <div id="jobsList"></div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <p>¬© 2025 Myrealtrip. All Rights Reserved.</p>
    <p style="margin-top: 0.5rem; font-size: 0.875rem;">
      Powered by NVIDIA minimax-m2, Google Custom Search, and LangChain
    </p>
  </footer>

  <script>
    let currentJobId = null;
    let statusInterval = null;
    let logsInterval = null;
    let lastLogCount = 0;
    
    // Agent definitions (7 agents: 4 CrewAI + 3 post-processing)
    const agents = [
      {id: "pm", name: "Product Manager", icon: "üëî", role: "Team Leader & Coordinator"},
      {id: "researcher", name: "Research Analyst", icon: "üîç", role: "Industry Research"},
      {id: "designer", name: "Assignment Designer", icon: "‚úèÔ∏è", role: "Question Creation"},
      {id: "reviewer", name: "QA Reviewer", icon: "üîé", role: "Quality Assurance"},
      {id: "data", name: "Data Provider", icon: "üìä", role: "Dataset Generation"},
      {id: "builder", name: "Web Builder", icon: "üåê", role: "Portal Creation"},
      {id: "styler", name: "Web Designer", icon: "üé®", role: "Styling & Design"}
    ];

    // Form submission
    document.getElementById('generateForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      console.log('üöÄ Form submitted');
      
      const formData = {
        job_role: document.getElementById('jobRole').value,
        job_level: document.getElementById('jobLevel').value,
        language: document.getElementById('language').value
      };
      
      console.log('üìã Form data:', formData);

      // Validate
      if (!formData.job_role || !formData.job_level) {
        alert('Please fill in all required fields');
        console.error('‚ùå Validation failed - missing fields');
        return;
      }

      // Disable form
      const btn = document.getElementById('generateBtn');
      btn.disabled = true;
      btn.classList.add('btn--loading');
      console.log('üîÑ Button disabled, making API call...');

      try {
        console.log('üì° Calling /api/generate...');
        const response = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        console.log('üì° Response status:', response.status);
        const result = await response.json();
        console.log('üì° Response data:', result);

        if (result.success) {
          console.log('‚úÖ Generation started successfully');
          currentJobId = result.job_id;
          console.log('üÜî Job ID:', currentJobId);
          document.getElementById('jobIdDisplay').textContent = currentJobId;
          showStatusCard();
          startStatusPolling();
        } else {
          console.error('‚ùå Generation failed:', result.error);
          alert('Error: ' + result.error);
          resetForm();
        }
      } catch (error) {
        console.error('‚ùå Exception:', error);
        alert('Error: ' + error.message + '\n\nCheck browser console (F12) for details');
        resetForm();
      }
    });

    function initializeAgents() {
      const grid = document.getElementById('agentsGrid');
      grid.innerHTML = agents.map(agent => `
        <div class="agent-card pending" id="agent-${agent.id}" data-agent-id="${agent.id}">
          <span class="agent-badge">ACTIVE</span>
          <span class="agent-icon">${agent.icon}</span>
          <div class="agent-name">${agent.name}</div>
          <div class="agent-role">${agent.role}</div>
        </div>
      `).join('');
    }

    function updateAgentStatus(agentId, status) {
      const card = document.getElementById(`agent-${agentId}`);
      if (!card) return;
      
      // Remove all status classes
      card.classList.remove('pending', 'active', 'reviewing', 'completed');
      
      // Add new status class
      card.classList.add(status);
    }

    function parseAgentConversations(logs) {
      if (!logs || logs.length === 0) return {};
      
      const conversations = {
        pm: [],
        researcher: [],
        designer: [],
        reviewer: [],
        data: [],
        builder: [],
        styler: []
      };
      
      const allLogs = logs.join('\n');
      
      // Parse agent-specific messages with [Agent Name] format
      const agentPatterns = [
        { id: 'pm', pattern: /üëî\s*\[PM\].*?(?=(?:üëî\s*\[PM\]|üîç\s*\[Research|‚úèÔ∏è\s*\[Assignment|üîé\s*\[QA|üìù\s*\[Technical|$))/gs },
        { id: 'pm', pattern: /\[Product Manager\].*?(?=\[|$)/gs },
        { id: 'researcher', pattern: /üîç\s*\[Research.*?\].*?(?=(?:üëî\s*\[PM\]|üîç\s*\[Research|‚úèÔ∏è\s*\[Assignment|üîé\s*\[QA|$))/gs },
        { id: 'designer', pattern: /‚úèÔ∏è\s*\[Assignment.*?\].*?(?=(?:üëî\s*\[PM\]|üîç\s*\[Research|‚úèÔ∏è\s*\[Assignment|üîé\s*\[QA|$))/gs },
        { id: 'reviewer', pattern: /üîé\s*\[QA.*?\].*?(?=(?:üëî\s*\[PM\]|üîç\s*\[Research|‚úèÔ∏è\s*\[Assignment|üîé\s*\[QA|$))/gs },
      ];
      
      // Also detect by keywords if no brackets
      logs.forEach((log, idx) => {
        const lower = log.toLowerCase();
        
        if (lower.includes('[pm]') || lower.includes('product manager')) {
          conversations.pm.push(log);
        } else if (lower.includes('[research') || lower.includes('research analyst') || lower.includes('searching google cse')) {
          conversations.researcher.push(log);
        } else if (lower.includes('[assignment') || lower.includes('assignment designer') || lower.includes('generating assignments')) {
          conversations.designer.push(log);
        } else if (lower.includes('[qa') || lower.includes('qa reviewer') || lower.includes('reviewing quality')) {
          conversations.reviewer.push(log);
        } else if (lower.includes('dataset') || lower.includes('data provider') || lower.includes('generating datasets')) {
          conversations.data.push(log);
        } else if (lower.includes('starter code') || lower.includes('generating starter')) {
          conversations.designer.push(log);  // Starter code with designer
        } else if (lower.includes('web page') || lower.includes('web builder') || lower.includes('building web portal') || lower.includes('index.html')) {
          conversations.builder.push(log);
        } else if (lower.includes('css saved') || lower.includes('web designer') || lower.includes('applying custom styling') || lower.includes('styles.css')) {
          conversations.styler.push(log);
        }
      });
      
      return conversations;
    }
    
    function updateActivityBoxes(conversations) {
      // Update each agent's activity box with formatted summary
      Object.entries(conversations).forEach(([agentId, messages]) => {
        const summaryEl = document.getElementById(`summary-${agentId}`);
        const badgeEl = document.getElementById(`status-badge-${agentId}`);
        const boxEl = document.getElementById(`activity-${agentId}`);
        
        if (!summaryEl || !badgeEl || !boxEl) return;
        
        // Store full logs for modal
        agentFullLogs[agentId] = messages.join('\n');
        
        if (messages.length > 0) {
          // Update summary with HTML formatting
          const summaryHTML = summarizeAgentActivity(messages);
          summaryEl.innerHTML = summaryHTML;
          badgeEl.textContent = 'Active';
        }
      });
    }
    
    function detectActiveAgent(logs) {
      if (!logs || logs.length === 0) return 'pm';
      
      // Check recent logs to determine active agent
      const recentLogs = logs.slice(-5).join(' ').toLowerCase();
      
      if (recentLogs.includes('research analyst') || recentLogs.includes('searching google cse') || 
          recentLogs.includes('google_cse_search')) {
        return 'researcher';
      } else if (recentLogs.includes('assignment designer') || recentLogs.includes('generating assignments') ||
                 recentLogs.includes('creating assignment')) {
        return 'designer';
      } else if (recentLogs.includes('qa reviewer') || recentLogs.includes('reviewing quality')) {
        return 'reviewer';
      } else if (recentLogs.includes('data provider') || recentLogs.includes('generated dataset') || recentLogs.includes('generating datasets')) {
        return 'data';
      } else if (recentLogs.includes('starter code') || recentLogs.includes('generating starter')) {
        return 'designer';  // Starter code phase uses designer context
      } else if (recentLogs.includes('web builder') || recentLogs.includes('building web portal') || recentLogs.includes('web page generated')) {
        return 'builder';
      } else if (recentLogs.includes('web designer') || recentLogs.includes('applying custom styling') || recentLogs.includes('css saved')) {
        return 'styler';
      } else if (recentLogs.includes('product manager') || recentLogs.includes('[pm]')) {
        return 'pm';
      }
      
      return null; // No specific agent active
    }
    
    function detectActiveAgentFromLogs(messages) {
      if (!messages || messages.length === 0) return null;
      
      const recent = messages.slice(-3).join(' ').toLowerCase();
      
      if (recent.includes('research') || recent.includes('searching')) return 'researcher';
      if (recent.includes('designer') || recent.includes('creating')) return 'designer';
      if (recent.includes('reviewer') || recent.includes('reviewing')) return 'reviewer';
      
      return null;
    }

    function showDiscussionPhase(logs) {
      if (!logs) return false;
      
      const allLogs = logs.join(' ').toLowerCase();
      const isDiscussing = allLogs.includes('review') || 
                          allLogs.includes('feedback') || 
                          allLogs.includes('revision') ||
                          allLogs.includes('discussion');
      
      const phase = document.getElementById('discussionPhase');
      if (isDiscussing && !phase.classList.contains('visible')) {
        phase.classList.add('visible');
        
        // Update discussion content based on what's happening
        let content = 'Agents are collaborating and reviewing outputs...';
        if (allLogs.includes('quality review')) {
          content = 'üîé QA Reviewer is examining assignments for quality and completeness...';
        } else if (allLogs.includes('documentation review')) {
          content = 'üìù Technical Writer is reviewing documentation clarity...';
        } else if (allLogs.includes('final coordination')) {
          content = 'üëî PM is coordinating final team sign-off and delivery...';
        }
        
        document.getElementById('discussionContent').textContent = content;
      }
      
      return isDiscussing;
    }

    function showStatusCard() {
      document.getElementById('statusCard').classList.add('visible');
      document.querySelector('.form-card').style.display = 'none';
      
      // Initialize agent cards
      initializeAgents();
      
      // Reset logs
      lastLogCount = 0;
      const container = document.getElementById('logsContainer');
      container.innerHTML = '<div class="logs-empty" id="logsEmpty">Waiting for agents to start...</div>';
      container.classList.remove('visible');  // Start collapsed
      document.getElementById('logsToggle').classList.add('collapsed');
      
      // Initialize activity boxes
      initializeActivityBoxes();
    }
    
    function initializeActivityBoxes() {
      const grid = document.getElementById('activitiesGrid');
      grid.innerHTML = agents.map(agent => `
        <div class="activity-box" id="activity-${agent.id}" onclick="openActivityModal('${agent.id}')" data-agent-id="${agent.id}">
          <div class="activity-header">
            <span class="activity-icon">${agent.icon}</span>
            <div class="activity-agent-info">
              <div class="activity-agent-name">${agent.name}</div>
              <span class="activity-status-badge" id="status-badge-${agent.id}">Waiting</span>
            </div>
          </div>
          <div class="activity-summary" id="summary-${agent.id}">
            <div class="activity-empty">Not started yet...</div>
          </div>
          <div class="activity-expand-hint">Click to expand ‚Üí</div>
        </div>
      `).join('');
    }
    
    let agentFullLogs = {};
    
    function openActivityModal(agentId) {
      const agent = agents.find(a => a.id === agentId);
      if (!agent) return;
      
      const modal = document.getElementById('activityModal');
      document.getElementById('modalIcon').textContent = agent.icon;
      document.getElementById('modalName').textContent = agent.name;
      document.getElementById('modalRole').textContent = agent.role;
      
      // Format the full conversation with styling
      const rawMessages = (agentFullLogs[agentId] || '').split('\n');
      const formattedContent = formatFullConversation(rawMessages, agentId);
      document.getElementById('modalBody').innerHTML = formattedContent;
      
      modal.classList.add('visible');
    }
    
    function closeActivityModal() {
      document.getElementById('activityModal').classList.remove('visible');
    }
    
    // Close modal on outside click
    document.getElementById('activityModal')?.addEventListener('click', function(e) {
      if (e.target === this) {
        closeActivityModal();
      }
    });
    
    function formatAgentMessage(text, agentId) {
      // Format agent message with proper styling
      const agentMap = {
        pm: {icon: 'üëî', name: 'PM', class: 'pm'},
        researcher: {icon: 'üîç', name: 'Research Analyst', class: 'researcher'},
        designer: {icon: '‚úèÔ∏è', name: 'Assignment Designer', class: 'designer'},
        reviewer: {icon: 'üîé', name: 'QA Reviewer', class: 'reviewer'},
        data: {icon: 'üìä', name: 'Data Provider', class: 'data'},
        builder: {icon: 'üåê', name: 'Web Builder', class: 'builder'},
        styler: {icon: 'üé®', name: 'Web Designer', class: 'designer'}
      };
      
      const agent = agentMap[agentId] || {icon: 'ü§ñ', name: 'Agent', class: 'default'};
      
      return `
        <div class="agent-message ${agent.class}">
          <div class="agent-speaker">
            <span class="agent-speaker-icon">${agent.icon}</span>
            <span>${agent.name}</span>
          </div>
          <div>${text}</div>
        </div>
      `;
    }
    
    function summarizeAgentActivity(messages) {
      if (!messages || messages.length === 0) return '<div class="activity-empty">Not started yet...</div>';
      
      // Take last 3-5 meaningful lines as summary
      const meaningful = messages.filter(m => {
        const trimmed = m.trim();
        return trimmed.length > 10 && 
               !trimmed.match(/^‚ïê+$/) && 
               !trimmed.match(/^‚îÄ+$/) &&
               !trimmed.startsWith('‚ï≠') &&
               !trimmed.startsWith('‚ï∞') &&
               !trimmed.includes('Crew Execution') &&
               !trimmed.includes('Task Completion');
      });
      
      if (meaningful.length === 0) return '<div class="activity-empty">Processing...</div>';
      
      // Get last 3 lines or recent activity
      const recentLines = meaningful.slice(-3);
      
      // Format each line
      let html = '';
      recentLines.forEach(line => {
        // Check if it's a task start
        if (line.includes('Task:') || line.includes('üìã')) {
          html += `<div class="task-label">${line}</div>`;
        } else {
          html += `<div>${line}</div>`;
        }
      });
      
      // Truncate if too long
      if (html.length > 300) {
        html = html.substring(0, 297) + '...';
      }
      
      return html || '<div class="activity-empty">Processing...</div>';
    }
    
    function formatFullConversation(messages, agentId) {
      // Format full conversation with task separators and agent markers
      if (!messages || messages.length === 0) return 'No activity yet...';
      
      let html = '';
      let currentTask = null;
      
      messages.forEach((msg, idx) => {
        const trimmed = msg.trim();
        if (!trimmed) return;
        
        // Detect task changes
        if (trimmed.includes('Task:') && !trimmed.includes('Completion')) {
          if (currentTask !== null) {
            html += '<div class="task-separator"></div>';
          }
          html += `<div class="task-label">üìã ${trimmed}</div>`;
          currentTask = trimmed;
          return;
        }
        
        // Skip decorative lines
        if (trimmed.match(/^[‚îÄ‚ïê‚îÇ‚ï≠‚ïÆ‚ïØ‚ï∞‚îú‚î§‚î¨‚î¥‚îº\s]+$/) || 
            trimmed.includes('Crew Execution') ||
            trimmed.includes('Memory Retrieval')) {
          return;
        }
        
        // Format agent messages
        if (trimmed.startsWith('üëî') || trimmed.includes('[PM]')) {
          html += formatAgentMessage(trimmed.replace(/^üëî\s*/, '').replace('[PM]', '').trim(), 'pm');
        } else if (trimmed.startsWith('üîç') || trimmed.includes('[Research')) {
          html += formatAgentMessage(trimmed.replace(/^üîç\s*/, '').replace(/\[Research.*?\]/, '').trim(), 'researcher');
        } else if (trimmed.startsWith('‚úèÔ∏è') || trimmed.includes('[Assignment')) {
          html += formatAgentMessage(trimmed.replace(/^‚úèÔ∏è\s*/, '').replace(/\[Assignment.*?\]/, '').trim(), 'designer');
        } else if (trimmed.startsWith('üîé') || trimmed.includes('[QA')) {
          html += formatAgentMessage(trimmed.replace(/^üîé\s*/, '').replace(/\[QA.*?\]/, '').trim(), 'reviewer');
        } else if (trimmed.startsWith('üìù') || trimmed.includes('[Technical')) {
          html += formatAgentMessage(trimmed.replace(/^üìù\s*/, '').replace(/\[Technical.*?\]/, '').trim(), 'writer');
        } else {
          // Regular message
          html += `<div style="margin: 0.25rem 0;">${trimmed}</div>`;
        }
      });
      
      return html || 'No activity yet...';
    }

    function startStatusPolling() {
      // Clear any existing intervals
      if (statusInterval) {
        clearInterval(statusInterval);
      }
      if (logsInterval) {
        clearInterval(logsInterval);
      }

      // Poll status every 2 seconds
      statusInterval = setInterval(checkStatus, 2000);
      checkStatus(); // Check immediately
      
      // Poll logs every 1 second for real-time updates
      logsInterval = setInterval(fetchLogs, 1000);
      fetchLogs(); // Check immediately
    }

    async function checkStatus() {
      if (!currentJobId) return;

      try {
        const response = await fetch(`/api/status/${currentJobId}`);
        
        // Handle 404 gracefully - job might not be initialized yet
        if (response.status === 404) {
          console.log(`Job ${currentJobId} not found yet, waiting...`);
          return;
        }
        
        const result = await response.json();

        if (result.success) {
          updateStatusUI(result.status);

          if (result.status.status === 'completed' || result.status.status === 'failed') {
            clearInterval(statusInterval);
            clearInterval(logsInterval);
            loadRecentJobs();
          }
        }
      } catch (error) {
        console.error('Status check error:', error);
      }
    }

    async function fetchLogs() {
      if (!currentJobId) return;

      try {
        const response = await fetch(`/api/logs/${currentJobId}`);
        
        // Handle 404 gracefully - job might not be initialized yet
        if (response.status === 404) {
          return;
        }
        
        const result = await response.json();

        if (result.success && result.logs && result.logs.length > 0) {
          if (result.count > lastLogCount) {
            displayLogs(result.logs);
            lastLogCount = result.count;
          }
        }
      } catch (error) {
        console.error('Logs fetch error:', error);
      }
    }

    function displayLogs(logs) {
      const container = document.getElementById('logsContainer');
      const emptyMsg = document.getElementById('logsEmpty');
      
      if (emptyMsg) {
        emptyMsg.remove();
      }

      // Clear container if starting fresh
      if (lastLogCount === 0) {
        container.innerHTML = '';
      }

      // Add new log lines
      logs.slice(lastLogCount).forEach(log => {
        const logLine = document.createElement('div');
        logLine.className = 'log-line';
        
        // Apply syntax highlighting based on content
        if (log.includes('Thought:') || log.includes('I need to') || log.includes('I should')) {
          logLine.classList.add('agent-thought');
        } else if (log.includes('Action:') || log.includes('Tool:') || log.includes('üîç Searching')) {
          logLine.classList.add('agent-action');
        } else if (log.includes('Observation:') || log.includes('‚úÖ Found')) {
          logLine.classList.add('agent-observation');
        } else if (log.includes('Final Answer:') || log.includes('Generation complete')) {
          logLine.classList.add('agent-final');
        } else if (log.includes('Error') || log.includes('error') || log.includes('‚ùå')) {
          logLine.classList.add('error');
        } else if (log.includes('‚úÖ') || log.includes('saved')) {
          logLine.classList.add('success');
        }
        
        logLine.textContent = log;
        container.appendChild(logLine);
      });

      // Auto-scroll to bottom
      container.scrollTop = container.scrollHeight;
      
      // Parse and display agent activity in boxes
      const conversations = parseAgentConversations(logs);
      updateActivityBoxes(conversations);
      
      // Update agent status based on logs
      const activeAgent = detectActiveAgent(logs);
      const allLogsText = logs.join(' ').toLowerCase();
      
      agents.forEach(agent => {
        const activityBox = document.getElementById(`activity-${agent.id}`);
        const statusBadge = document.getElementById(`status-badge-${agent.id}`);
        
        // Remove active class first
        if (activityBox) {
          activityBox.classList.remove('active');
        }
        
        // Check if this is the currently active agent
        if (agent.id === activeAgent) {
          updateAgentStatus(agent.id, 'active');
          if (activityBox) activityBox.classList.add('active');
          if (statusBadge) statusBadge.textContent = 'ACTIVE NOW';
        } 
        // Check if agent completed their work (specific completion markers)
        else if (
          (agent.id === 'pm' && allLogsText.includes('decision: approved')) ||
          (agent.id === 'researcher' && allLogsText.includes('research') && allLogsText.includes('summary')) ||
          (agent.id === 'designer' && allLogsText.includes('assignments') && (allLogsText.includes('saved') || allLogsText.includes('generated'))) ||
          (agent.id === 'reviewer' && allLogsText.includes('approved')) ||
          (agent.id === 'data' && allLogsText.includes('dataset generation complete')) ||
          (agent.id === 'builder' && allLogsText.includes('web page generated')) ||
          (agent.id === 'styler' && allLogsText.includes('css saved'))
        ) {
          updateAgentStatus(agent.id, 'completed');
          if (activityBox) activityBox.classList.add('completed');
          if (activityBox) activityBox.classList.remove('active');
          if (statusBadge) statusBadge.textContent = 'Completed ‚úÖ';
        }
        // Agent has some activity but not active now
        else if (conversations[agent.id] && conversations[agent.id].length > 0) {
          if (statusBadge) statusBadge.textContent = 'Working';
          if (activityBox) activityBox.classList.remove('active', 'completed');
        }
      });
      
      // Show discussion phase if detected
      showDiscussionPhase(logs);
    }

    function toggleLogs() {
      const container = document.getElementById('logsContainer');
      const toggle = document.getElementById('logsToggle');
      
      if (container.classList.contains('visible')) {
        container.classList.remove('visible');
        toggle.classList.add('collapsed');
      } else {
        container.classList.add('visible');
        toggle.classList.remove('collapsed');
        // Scroll to bottom when expanding
        container.scrollTop = container.scrollHeight;
      }
    }

    function updateStatusUI(status) {
      const icon = document.getElementById('statusIcon');
      const title = document.getElementById('statusTitle');
      const subtitle = document.getElementById('statusSubtitle');
      const message = document.getElementById('statusMessage');
      const progressBar = document.getElementById('progressBar');
      const actions = document.getElementById('statusActions');
      const resultLink = document.getElementById('resultLink');

      if (status.status === 'running' || status.status === 'initializing') {
        icon.className = 'status-icon status-icon--running';
        icon.textContent = '‚ö°';
        title.textContent = 'Generating...';
        subtitle.textContent = 'This may take 4-6 minutes';
        message.textContent = status.progress || 'Processing...';
        progressBar.style.width = '60%';
        actions.style.display = 'none';
      } else if (status.status === 'completed') {
        icon.className = 'status-icon status-icon--completed';
        icon.textContent = '‚úÖ';
        title.textContent = 'Generation Complete!';
        subtitle.textContent = 'Your tech test is ready';
        message.textContent = 'Successfully generated all assets including research, assignments, datasets, starter code, and portal.';
        progressBar.style.width = '100%';
        actions.style.display = 'block';
        
        // Mark all agents as completed
        agents.forEach(agent => {
          updateAgentStatus(agent.id, 'completed');
          const activityBox = document.getElementById(`activity-${agent.id}`);
          const statusBadge = document.getElementById(`status-badge-${agent.id}`);
          if (activityBox) activityBox.classList.add('completed');
          if (statusBadge) statusBadge.textContent = 'Completed ‚úÖ';
        });
        
        if (status.index_url) {
          resultLink.href = status.index_url;
        } else if (status.output_dir) {
          // Construct URL from output dir
          const dirName = status.output_dir.split('/').pop();
          resultLink.href = `/output/${dirName}/index.html`;
        }
      } else if (status.status === 'failed') {
        icon.className = 'status-icon status-icon--failed';
        icon.textContent = '‚ùå';
        title.textContent = 'Generation Failed';
        subtitle.textContent = 'An error occurred';
        message.textContent = status.error || 'Unknown error';
        progressBar.style.width = '0%';
        actions.style.display = 'none';
      }
    }

    async function loadRecentJobs() {
      try {
        const response = await fetch('/api/jobs');
        const result = await response.json();

        if (result.success && result.jobs.length > 0) {
          const jobsSection = document.getElementById('jobsSection');
          const jobsList = document.getElementById('jobsList');
          
          jobsList.innerHTML = result.jobs.slice(0, 5).map(job => `
            <div class="job-card">
              <div class="job-card__header">
                <div class="job-card__title">${job.started_at ? new Date(job.started_at).toLocaleString() : 'N/A'}</div>
                <span class="job-card__badge job-card__badge--${job.status}">${job.status}</span>
              </div>
              <div class="job-card__info">${job.progress}</div>
              ${job.index_url ? `<a href="${job.index_url}" target="_blank" class="result-link" style="margin-top: 0.75rem; display: inline-flex;">View Result</a>` : ''}
            </div>
          `).join('');
          
          jobsSection.style.display = 'block';
        }
      } catch (error) {
        console.error('Failed to load jobs:', error);
      }
    }

    function resetForm() {
      const btn = document.getElementById('generateBtn');
      btn.disabled = false;
      btn.classList.remove('btn--loading');
    }

    // Load recent jobs on page load
    loadRecentJobs();
  </script>
</body>
</html>

